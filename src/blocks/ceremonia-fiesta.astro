---
interface Props { name: string; startDate: string; endDate: string; fechatext: string; salon: string; direccion: string; }
const { name, startDate, endDate, fechatext, salon, direccion } = Astro.props;
---

<section class="ceremonia-fiesta" >
  <picture>
    <source type="image/webp" srcset="/flores_Grupo02_A.webp">
    <source type="image/png" srcset="/flores_Grupo02_A.png">
    <img 
      class="adorno adorno-1 aos-init aos-animate" 
      data-aos="fade-right" 
      data-aos-delay="300" 
      data-aos-duration="1000" 
      data-aos-once="false" 
      alt="" 
      src="/flores_Grupo02_A.png" 
      loading="lazy">
  </picture>


  <picture>
    <source type="image/webp" srcset="/flores_Grupo02_B.webp">
    <source type="image/png" srcset="/flores_Grupo02_B.png">
    <img 
      class="adorno adorno-2 aos-init" 
      data-aos="fade-right" 
      data-aos-delay="400" 
      data-aos-duration="1000" 
      data-aos-once="false" 
      alt="" 
      src="/flores_Grupo02_B.png" 
      loading="lazy">
  </picture>


  <picture>
    <source type="image/webp" srcset="/flores_Grupo02_C.webp">
    <source type="image/png" srcset="/flores_Grupo02_C.png">
    <img 
      class="adorno adorno-3 aos-init aos-animate" 
      data-aos="fade-right" 
      data-aos-delay="500" 
      data-aos-duration="1000" 
      data-aos-once="false" 
      alt="" 
      src="/flores_Grupo02_C.png" 
      loading="lazy">
  </picture>




  <div class="container" >
    <div class="row d-flex justify-content-center">
      <div class=" col-md-6 col-fiesta text-center">
        <div class="anim-fiesta" > 
        </div>
        <br>
        <h3 id="informacion-fiesta">Fiesta</h3>

        <div class="info-col">

          <div class="info-box" id="fecha">
            <h6>Día</h6>
            <p>{fechatext}</p>
            <a href="/eventCalendar/evento.ics" class="boton boton--azul" download>Agendar</a>
          </div>

          <div class="info-box" id="confirmar-asistencia">
            <h6>Lugar</h6>
            <p>{salon}</p>
            <a href="#" data-evento="Fiesta" class="boton boton--azul confirmar-asistencia">Confirmar asistencia</a>
          </div>

          <div class="info-box" id="direccion">
            <h6>Dirección</h6>
            <p>{direccion}</p>
            <a href="#" data-evento="Fiesta" class="boton boton--azul modal-como-llegar">¿Cómo llegar?</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  
    // Abrir modal
    $('body').on('click', 'a.modal-como-llegar', function(e) {

      e.preventDefault();

      // Para modelos de 15 años, siempre es Fiesta
      var latitud = -34.614903016530114;
      var longitud = -58.371135930823804;
      var linkMapConfigured = "https://maps.app.goo.gl/HnweR39V4qJx9imu7";
      var iframeSrc = '';
      var linkMaps = '';

      // Validar si hay coordenadas válidas
      var coordenadasValidas = (latitud !== 0 && longitud !== 0 && latitud !== null && longitud !== null);

      // Generar URL del iframe siempre con coordenadas
      if(coordenadasValidas) {
        // IFRAME: Siempre usa coordenadas (es la única forma confiable)
        iframeSrc = 'https://www.google.com/maps?q=' + latitud + ',' + longitud + '&output=embed';
        
        // AMPLIAR MAPA: Usa linkMaps si está configurado, sino usa coordenadas
        if(linkMapConfigured != '' && linkMapConfigured != null) {
          linkMaps = linkMapConfigured;
        } else {
          linkMaps = 'https://www.google.com/maps/search/?api=1&query=' + latitud + ',' + longitud;
        }
      } 
      // No hay coordenadas válidas
      else {
        console.warn('No hay coordenadas configuradas para el mapa');
        iframeSrc = 'https://www.google.com/maps?q=0,0&output=embed';
        linkMaps = linkMapConfigured != '' ? linkMapConfigured : 'https://www.google.com/maps';
      }

      // // Cambio titulo
      // $('#modalMapa .modal-title').text(titleModalMapa);

      // Mostrar loader y ocultar iframe temporalmente
      $('#mapLoader').removeClass('hidden');
      $('#googleMapIframe').css('opacity', '0');

      // Cargo el iframe con la URL generada
      $('#googleMapIframe').attr('src', iframeSrc);

      // Ocultar loader cuando el iframe termine de cargar
      $('#googleMapIframe').off('load').on('load', function() {
        $('#mapLoader').addClass('hidden');
        $('#googleMapIframe').css('opacity', '1');
      });

      // Genero el link para ampliar mapa
      $('.ampliar-mapa').attr('href', linkMaps);

      // Abrir modal
      // @ts-ignore
      $('#modalMapa').modal({
        backdrop: 'static'
      });

    });

    // Resetear loader cuando se cierra el modal
    $('#modalMapa').on('hidden.bs.modal', function() {
      $('#mapLoader').removeClass('hidden');
      $('#googleMapIframe').css('opacity', '0');
      $('#googleMapIframe').attr('src', '');
    });
  
</script>